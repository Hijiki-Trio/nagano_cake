<div class="container index-wrapper">
  <h3>ショッピングカート</h3>
  <% if @cart_products.present? %>
    <div class="row cart-table">
      <table border="1">
        <tr>
          <th>商品名</th>
          <th>単価(税込)</th>
          <th>数量</th>
          <th>小計</th>
          <th></th>
        </tr>
        <% @sum = 0 %>
        <% @cart_products.each do |cart_product| %>
        <tr>
          <td>
            <%= attachment_image_tag cart_product.product, :image, class: 'cart-product-index-image' %>
            <%= cart_product.product.name %>
          </td>
          <td>¥<%= converting_to_jpy(cart_product.product.price) %></td>
          <%= form_with model: cart_product, local:true do |f| %>
          <td>
            <%= f.select :quantity, {'1': 1, '2': 2, '3': 3, '4': 4, '5': 5}, :selected => cart_product.quantity, class: "form-control col mr-3" %>
            <%= f.submit "編集", class: "btn btn-sm btn-info" %>
          </td>
          <td>¥<%= converting_to_jpy(cart_product.product.price * cart_product.quantity) %></td>
          <td><%= link_to "削除", cart_product_path(cart_product), method: :delete, class: "btn btn-sm btn-danger" %></td>
          <% end %>
        </tr>
        <% @sum += cart_product.product.price * cart_product.quantity %>
        <% end %>
        <tr>
          <td></td>
          <td></td>
          <td></td>
          <th>合計金額</th>
          <td>¥<%= converting_to_jpy(@sum) %></td>
        </tr>
      </table>
    </div>
    <div class="row">
      <%= link_to "買い物を続ける", products_path, class: "btn btn-sm btn-info" %>
      <%= link_to "カートを空にする", cart_products_destroy_all_path, method: :delete, class: "btn btn-sm btn-danger", "data-confirm" => "カート内の商品を全て削除しますか？" %>
      <%= link_to "情報入力に進む", new_order_path, class: "btn btn-sm btn-primary" %>
    </div>
  <% else %>
    <h5 class="text-center">カートには何もありません！</h5>
  <% end %>
</div>